# Admin Panel User Guide

## 概述

VisuTry Admin Panel 是一个集中的后台运维系统，用于管理用户、订单和业务数据。本指南将帮助管理员快速上手使用后台系统。

---

## 目录

1. [访问后台系统](#访问后台系统)
2. [Dashboard 仪表盘](#dashboard-仪表盘)
3. [用户管理](#用户管理)
4. [订单管理](#订单管理)
5. [常见问题](#常见问题)

---

## 访问后台系统

### 前提条件

- 你的账户必须被授予 **ADMIN** 角色
- 已登录 VisuTry 系统

### 访问步骤

1. 登录 VisuTry 网站
2. 访问 `https://visutry.com/admin` 或点击导航栏中的"Admin"链接
3. 系统会自动验证你的管理员权限
   - ✅ 如果有权限，将进入后台首页
   - ❌ 如果无权限，将被重定向到首页并显示错误提示

### 权限说明

- 只有 `role = ADMIN` 的用户才能访问后台
- 所有 `/admin/*` 路径都受到中间件保护
- 未授权访问将被自动拦截

---

## Dashboard 仪表盘

Dashboard 是后台系统的首页，提供关键业务指标的实时概览。

### 访问路径
`/admin/dashboard`

### 主要功能

#### 1. 关键指标 (KPIs)

显示以下核心业务数据：

| 指标 | 说明 | 数据来源 |
|------|------|----------|
| **总用户数** | 注册用户总数 | User 表 |
| **Premium 用户数** | 当前活跃的付费用户 | User 表 (isPremium = true) |
| **总订单数** | 所有订单总数 | Payment 表 |
| **总收入** | 累计销售额 (USD) | Payment 表 (status = COMPLETED) |

#### 2. 最近活动

- 显示最近 10 条订单记录
- 包含订单号、用户、金额、状态等信息
- 点击可跳转到订单详情

### 使用建议

- 每日查看 Dashboard 了解业务动态
- 关注 Premium 用户数变化趋势
- 监控订单状态分布

---

## 用户管理

用户管理模块用于查看和管理所有注册用户。

### 访问路径
`/admin/users`

### 主要功能

#### 1. 用户列表

以表格形式展示所有用户，包含以下信息：

| 列名 | 说明 |
|------|------|
| **ID** | 用户唯一标识符 |
| **Name** | 用户姓名 |
| **Email** | 用户邮箱 |
| **Role** | 用户角色 (USER/ADMIN) |
| **Premium Status** | 是否为 Premium 用户 |
| **Created At** | 注册时间 |

#### 2. 搜索功能

- **搜索框**: 支持按邮箱或姓名模糊搜索
- **实时搜索**: 输入后自动更新结果
- **清空搜索**: 点击 "Clear" 按钮重置搜索

使用示例：
```
搜索邮箱: john@example.com
搜索姓名: John Doe
```

#### 3. 分页功能

- **每页显示**: 默认 10 条记录
- **翻页控制**: 
  - "Previous" - 上一页
  - "Next" - 下一页
- **页码显示**: 当前页 / 总页数

#### 4. 用户详情

点击用户行可查看详细信息：
- 基本信息 (姓名、邮箱、角色)
- Premium 状态和到期时间
- 使用配额 (免费试用、Premium 使用量、积分余额)
- 历史订单列表
- Try-On 任务历史

### 常见操作

#### 查找特定用户
1. 在搜索框输入用户邮箱或姓名
2. 查看搜索结果
3. 点击用户查看详情

#### 查看 Premium 用户
1. 在列表中查看 "Premium Status" 列
2. ✅ 表示当前为 Premium 用户
3. ❌ 表示普通用户

---

## 订单管理

订单管理模块用于查看和处理所有支付订单。

### 访问路径
`/admin/orders`

### 主要功能

#### 1. 订单列表

以表格形式展示所有订单，包含以下信息：

| 列名 | 说明 |
|------|------|
| **Order ID** | 订单唯一标识符 |
| **User Email** | 下单用户邮箱 |
| **Product Type** | 产品类型 (月度/年度订阅/积分包) |
| **Amount** | 订单金额 (USD) |
| **Status** | 订单状态 |
| **Created At** | 下单时间 |

#### 2. 订单状态

| 状态 | 说明 | 颜色标识 |
|------|------|----------|
| **PENDING** | 待支付 | 🟡 黄色 |
| **COMPLETED** | 已完成 | 🟢 绿色 |
| **FAILED** | 支付失败 | 🔴 红色 |
| **REFUNDED** | 已退款 | 🔵 蓝色 |

#### 3. 状态筛选

- **All**: 显示所有订单
- **Pending**: 仅显示待支付订单
- **Completed**: 仅显示已完成订单
- **Failed**: 仅显示失败订单
- **Refunded**: 仅显示已退款订单

使用方法：
1. 点击状态筛选下拉菜单
2. 选择要查看的状态
3. 列表自动更新

#### 4. 搜索功能

- 支持按用户邮箱搜索订单
- 实时搜索，自动更新结果

#### 5. 分页功能

- 每页显示 10 条订单
- 支持翻页浏览

#### 6. 订单详情

点击订单行可查看详细信息：
- 订单基本信息
- 用户信息
- 支付信息 (Stripe Session ID, Payment ID)
- 产品详情
- 订单时间线

### 常见操作

#### 查看待处理订单
1. 点击状态筛选
2. 选择 "Pending"
3. 查看所有待支付订单

#### 查找用户订单
1. 在搜索框输入用户邮箱
2. 查看该用户的所有订单
3. 点击订单查看详情

#### 核对收入
1. 筛选 "Completed" 状态订单
2. 查看 "Amount" 列
3. 与 Dashboard 总收入对比

#### 处理退款
1. 找到需要退款的订单
2. 记录 Stripe Payment ID
3. 登录 Stripe Dashboard 处理退款
4. 订单状态将自动更新为 "REFUNDED"

---

## 常见问题

### Q1: 如何成为管理员？

**A**: 需要数据库管理员运行以下脚本：

```bash
ADMIN_EMAIL=your-email@example.com npx tsx scripts/seed-admin.ts
```

或直接在数据库中将用户的 `role` 字段设置为 `ADMIN`。

### Q2: 为什么无法访问 /admin？

**A**: 可能的原因：
1. 未登录 - 请先登录系统
2. 无管理员权限 - 联系系统管理员授予 ADMIN 角色
3. Session 过期 - 重新登录

### Q3: 数据多久更新一次？

**A**: 
- Dashboard 数据：实时查询数据库
- 用户列表：实时数据
- 订单列表：实时数据

所有数据都是服务端实时获取，无缓存延迟。

### Q4: 如何处理退款？

**A**: 
1. 在订单管理中找到对应订单
2. 记录 Stripe Payment ID
3. 登录 [Stripe Dashboard](https://dashboard.stripe.com)
4. 在 Payments 中搜索 Payment ID
5. 点击 "Refund" 处理退款
6. Webhook 会自动更新订单状态

### Q5: 搜索功能支持哪些字段？

**A**:
- **用户搜索**: 邮箱、姓名 (模糊匹配)
- **订单搜索**: 用户邮箱 (精确匹配)

### Q6: 如何导出数据？

**A**: 
当前版本暂不支持数据导出功能。如需导出，请：
1. 联系技术团队
2. 或直接访问 Neon Database 导出

### Q7: 页面加载很慢怎么办？

**A**:
1. 检查网络连接
2. 使用分页功能，避免一次加载过多数据
3. 使用搜索和筛选功能缩小数据范围
4. 如持续缓慢，联系技术团队优化

### Q8: 如何查看用户的使用历史？

**A**:
1. 进入用户管理页面
2. 搜索并点击目标用户
3. 在用户详情页查看：
   - 历史订单
   - Try-On 任务记录
   - 配额使用情况

---

## 技术支持

如遇到问题或需要帮助，请联系：

- **技术支持**: tech-support@visutry.com
- **系统管理员**: admin@visutry.com

---

## 更新日志

### v1.0.0 (2025-10-21)
- ✅ 初始版本发布
- ✅ Dashboard 仪表盘
- ✅ 用户管理 (搜索、分页)
- ✅ 订单管理 (筛选、分页)
- ✅ 基于角色的访问控制

### 计划功能 (v2.0)
- 📋 操作日志审计
- 💰 快捷退款功能
- 📊 数据导出功能
- 📈 高级数据分析
- 🔔 实时通知系统

